# .copilot-instructions.md

## ðŸ§  Copilot Custom Rules for ESP8266 C++ Projects

### ðŸš€ Goal for Copilot

> Always produce code that looks like it was written by a careful, thoughtful engineer â€” not a rushed script generator.
> The code should teach, not confuse.
>
---

### ðŸŽ¯ General Goals

- Generate **clean, structured, modern C++ code** for the ESP8266 platform.
- Code must be **understandable by beginners** â€” include inline comments describing **what** each block does and **why**.
- Follow **non-blocking**, **event-driven**, and **modular** design.
- Prefer clarity over brevity or optimization.

---

### âš™ï¸ File Structure

- **`main.cpp`**: high-level logic, setup(), and loop().
- **`sensors.cpp / .h`**: sensor setup and reading logic.
- **`leds.cpp / .h`**: LED control and animation.
- **`config.h`**: pin definitions, constants, and configuration parameters.

Keep each file short and focused on one responsibility.

---

### ðŸ§© Naming and Style

- Use `camelCase` for variables and functions.
- Use `UPPER_CASE` for constants and macros.
- Avoid abbreviations â€” use meaningful names.
- Keep functions under ~30 lines.
- Each function starts with a short comment block explaining its purpose.

Example:

```cpp
/*
  Function: activateLights
  Purpose:  Gradually light up each step when motion is detected.
  Reason:   Creates a smooth animation effect for the staircase.
*/
```


---

### ðŸ§° Modern Practices

- Use `constexpr` instead of `#define` for constants.
- Avoid `delay()` â€” always use `millis()` or state-based timing.
- Prefer `ESPAsyncWebServer` over `ESP8266WebServer`.
- Prefer `LittleFS` over `SPIFFS`.
- Use `Adafruit_PWMServoDriver` for PCA9685.
- Use `auto` only if the type is obvious.
- Always check sensor values and connection states before using them.

---

### ðŸ’¡ Debugging and Error Handling

- Use conditional debug logging:

  ```cpp
  #ifdef DEBUG
  Serial.println("WiFi connected!");
  #endif
  ```

- Add comments before every logical decision or unusual calculation.
- Handle sensor or WiFi failures gracefully.

---

### ðŸª¶ Inline Comment Rules (Better Comments)

Use these icons for structured inline documentation:

| Symbol | Meaning                                 | Example                                                                |
| :----- | :-------------------------------------- | :--------------------------------------------------------------------- |
| ðŸŸ¢      | **TODO** â€“ Work to be done              | `// ðŸŸ¢ TODO: add WiFi reconnect logic`                                  |
| ðŸ”µ      | **INFO** â€“ Explanation or context       | `// ðŸ”µ INFO: using millis() instead of delay() for non-blocking timing` |
| ðŸŸ       | **WARNING** â€“ Potential issue           | `// ðŸŸ  WARNING: PCA9685 channel limit reached`                          |
| ðŸ”´      | **BUG / FIX** â€“ Known issue or bug      | `// ðŸ”´ BUG: brightness flickers when updating too fast`                 |
| âšª      | **NOTE** â€“ General comment or reasoning | `// âšª NOTE: this ensures LEDs fade smoothly`                           |

Each logical block must start with one or two descriptive inline comments explaining _what_ happens and _why_.

Example:

```cpp
// ðŸ”µ INFO: Read motion sensor to detect someone approaching the stairs
// âšª NOTE: A short debounce prevents false triggers from noise
if (digitalRead(motionPin) == HIGH && millis() - lastTrigger > debounceDelay) {
    activateLights();
}
```

---

### ðŸ§± Formatting and Organization

- Use consistent indentation (2 or 4 spaces, project standard).
- Group constants and global variables at the top.
- Separate setup code, runtime logic, and utility functions clearly.
- Avoid large blocks of commented-out code â€” remove or explain them.

---

### ðŸ§  Copilot Behavior

When generating code:

1. **Always add comments** describing what and why before logical steps.
2. **Avoid outdated libraries** or deprecated APIs.
3. **Favor modern, modular patterns** (state machines, async handlers).
4. **Ensure compile-ready code** â€” no pseudo-code placeholders.
5. **Explain design choices inline**.

---

### âœ… Example Pattern

```cpp
#include <Arduino.h>
#include <Adafruit_PWMServoDriver.h>

Adafruit_PWMServoDriver pwm = Adafruit_PWMServoDriver(0x40);

// âšª NOTE: Constants for LED setup
constexpr uint8_t LED_COUNT = 10;
constexpr uint16_t BRIGHTNESS_MAX = 4095;

// âšª NOTE: Variables for timing
unsigned long lastUpdate = 0;
const unsigned long updateInterval = 100; // in ms

void setup() {
  // ðŸ”µ INFO: Initialize serial for debugging
  Serial.begin(115200);

  // ðŸ”µ INFO: Initialize PWM driver and set frequency for LED control
  pwm.begin();
  pwm.setPWMFreq(1000);

  // âšª NOTE: Start with all LEDs turned off
  for (int i = 0; i < LED_COUNT; i++) pwm.setPWM(i, 0, 0);
}

void loop() {
  // ðŸ”µ INFO: Update LEDs at a fixed interval
  if (millis() - lastUpdate > updateInterval) {
    lastUpdate = millis();

    // âšª NOTE: Simple breathing effect for testing LED response
    static uint16_t brightness = 0;
    static bool increasing = true;

    brightness += increasing ? 100 : -100;
    if (brightness >= BRIGHTNESS_MAX || brightness == 0) increasing = !increasing;

    // ðŸŸ¢ TODO: Replace with motion-triggered light effect later
    for (int i = 0; i < LED_COUNT; i++) pwm.setPWM(i, 0, brightness);
  }
}
```
 




