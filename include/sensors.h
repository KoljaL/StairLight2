// Generated by Copilot
#ifndef SENSORS_H
#define SENSORS_H

#include <Arduino.h>
#include "config.h"

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”µ INFO: Motion Direction Enumeration
// âšª NOTE: Determines which lighting effect to trigger
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

enum class MotionDirection
{
  NONE = 0,
  WALK_UP,  // Detected at bottom sensor (going up)
  WALK_DOWN // Detected at top MPU6050 (going down)
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”µ INFO: Sensor Status Structure
// âšª NOTE: Used for debug output and web interface
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

struct SensorStatus
{
  float accelX;
  float accelY;
  float accelZ;
  float accelMagnitude;
  bool bottomSensorActive;
  bool motionDetected;
  unsigned long lastTriggerTime;
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ”µ INFO: Sensor Module Public Functions
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

/*
  Function: initSensors
  Purpose:  Initialize MPU6050 accelerometer and configure bottom sensor pin
  Reason:   Must be called during setup before reading sensor data
  Returns:  true if MPU6050 initialized successfully, false on error
*/
bool initSensors();

/*
  Function: calibrateMPU6050
  Purpose:  Establish baseline accelerometer readings for motion detection
  Reason:   Compensates for mounting angle and device variations
*/
void calibrateMPU6050();

/*
  Function: updateSensors
  Purpose:  Read current sensor values and update internal state
  Reason:   Should be called frequently in main loop for responsive detection
*/
void updateSensors();

/*
  Function: checkMotion
  Purpose:  Determine if motion detected and which direction
  Reason:   Core logic for triggering appropriate lighting effects
  Returns:  MotionDirection enum indicating detected motion type
*/
MotionDirection checkMotion();

/*
  Function: setAccelThreshold
  Purpose:  Adjust motion detection sensitivity
  Reason:   Allows user customization via web interface
*/
void setAccelThreshold(float threshold);

/*
  Function: setDebounceDelay
  Purpose:  Set minimum time between motion triggers
  Reason:   Prevents rapid re-triggering from sensor noise
*/
void setDebounceDelay(unsigned long delayMs);

/*
  Function: getSensorStatus
  Purpose:  Retrieve current sensor readings for debug/display
  Reason:   Enables real-time monitoring via web interface
*/
SensorStatus getSensorStatus();

/*
  Function: resetLastTrigger
  Purpose:  Clear the last trigger timestamp
  Reason:   Used when effect completes to allow immediate re-trigger
*/
void resetLastTrigger();

/*
  Function: setBottomSensorInstallMode
  Purpose:  Enable/disable installation mode for bottom sensor
  Reason:   Allows testing sensor placement - lights up when triggered
*/
void setBottomSensorInstallMode(bool enabled);

/*
  Function: setMotionInstallMode
  Purpose:  Enable/disable installation mode for motion sensor
  Reason:   Allows testing sensor placement - VU meter effect based on motion strength
*/
void setMotionInstallMode(bool enabled);

/*
  Function: isBottomSensorInstallMode
  Purpose:  Check if bottom sensor installation mode is active
  Returns:  true if installation mode is active
*/
bool isBottomSensorInstallMode();

/*
  Function: isMotionInstallMode
  Purpose:  Check if motion sensor installation mode is active
  Returns:  true if installation mode is active
*/
bool isMotionInstallMode();

/*
  Function: getMotionStrength
  Purpose:  Get current motion magnitude for VU meter display
  Returns:  Motion strength as percentage (0-100)
*/
uint8_t getMotionStrength();

#endif // SENSORS_H
